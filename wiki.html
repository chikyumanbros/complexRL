<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ComplexRL System Wiki</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        header {
            background-color: #333;
            color: #fff;
            padding: 20px;
            text-align: center;
        }
        h1 {
            margin: 0;
            font-size: 2.5em;
        }
        h2 {
            font-size: 1.8em;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
            margin-top: 40px;
        }
        h3 {
            font-size: 1.4em;
            margin-top: 30px;
            border-left: 4px solid #333;
            padding-left: 10px;
        }
        nav {
            background-color: #444;
            padding: 10px 0;
        }
        nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            justify-content: center;
        }
        nav li {
            margin: 0 15px;
        }
        nav a {
            color: #fff;
            text-decoration: none;
            font-weight: bold;
        }
        nav a:hover {
            text-decoration: underline;
        }
        .formula {
            background-color: #f0f0f0;
            padding: 10px;
            border-left: 3px solid #333;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .note {
            background-color: #ffffd9;
            padding: 10px;
            border-left: 3px solid #ffcc00;
            margin: 10px 0;
        }
        footer {
            text-align: center;
            padding: 20px;
            background-color: #333;
            color: #fff;
            margin-top: 40px;
        }
    </style>
</head>
<body>
    <header>
        <h1>ComplexRL System Wiki</h1>
    </header>
    <nav>
        <ul>
            <li><a href="#combat">Combat System</a></li>
            <li><a href="#stats">Stats & Derived Values</a></li>
            <li><a href="#skills">Skill System</a></li>
            <li><a href="#vigor">Vigor System</a></li>
            <li><a href="#health">Health Status</a></li>
            <li><a href="#danger">Danger Levels</a></li>
            <li><a href="#formulas">Formulas</a></li>
            <li><a href="#dice">Dice Rolls</a></li>
        </ul>
    </nav>
    <div class="container">
        <section id="combat">
            <h2>Combat System</h2>
            <p>
                ComplexRL's combat system is based on attack and defense dice rolls.
                The basic flow is as follows:
            </p>

            <h3>Combat Flow</h3>
            <ol>
                <li>Initiative check (speed comparison)</li>
                <li>Attacker's hit check</li>
                <li>Defender's evasion check</li>
                <li>Damage calculation (attack roll - defense roll)</li>
                <li>Effect application</li>
            </ol>

            <h3>Hit Check</h3>
            <p>
                The attacker's hit rate is calculated from base accuracy plus modifiers.
                The hit check is performed using a random roll based on this value, and if successful, the attack hits.
            </p>
            <div class="formula">
Hit Check = Random(1-100) <= Final Accuracy
Final Accuracy = Base Accuracy * (1 + Accuracy Modifier) * (1 - Surrounding Penalty)
            </div>

            <h3>Evasion Check</h3>
            <p>
                An evasion check is performed based on the defender's evasion rate.
                Evasion checks are skipped for critical hits and opportunity attacks.
            </p>
            <div class="formula">
Evasion Check = Random(1-100) <= Evasion Rate
            </div>

            <h3>Damage Calculation</h3>
            <p>
                Damage is calculated based on the attacker's attack power and the defender's defense.
                Attack power and defense are calculated from base values plus dice roll totals.
            </p>
            <div class="formula">
Damage = max(1, Adjusted Attack Power - Defense)
Adjusted Attack Power = (Base Attack + Attack Dice Roll Total) * Damage Multiplier
Defense = Base Defense + Defense Dice Roll Total
            </div>

            <h3>Attack Modifiers</h3>
            <p>
                Skills can apply modifiers to attacks. These modifiers change the following values:
            </p>
            <ul>
                <li>Accuracy Modifier (accuracyMod): Additively affects hit rate</li>
                <li>Damage Modifier (damageMod): Multiplicatively affects damage</li>
                <li>Speed Modifier (speedTier): Changes attack speed</li>
            </ul>

            <h3>Opportunity Attacks</h3>
            <p>
                Opportunity attacks occur when an enemy begins to flee and has an escape route.
                Opportunity attacks have the following properties:
            </p>
            <ul>
                <li>Accuracy Bonus: +20%</li>
                <li>Damage Bonus: +50%</li>
                <li>Evasion checks are skipped</li>
                <li>Ignores surrounding penalties</li>
            </ul>
        </section>

        <section id="stats">
            <h2>Stats & Derived Values</h2>
            
            <h3>Base Stats</h3>
            <table>
                <tr>
                    <th>Stat</th>
                    <th>Abbreviation</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td>Strength</td>
                    <td>STR</td>
                    <td>Affects physical attack power, damage, and ability to move large objects</td>
                </tr>
                <tr>
                    <td>Dexterity</td>
                    <td>DEX</td>
                    <td>Affects accuracy, evasion, movement speed, and reaction time</td>
                </tr>
                <tr>
                    <td>Constitution</td>
                    <td>CON</td>
                    <td>Affects maximum HP, defense, and resistance to status ailments</td>
                </tr>
                <tr>
                    <td>Intelligence</td>
                    <td>INT</td>
                    <td>Affects magic attack power, identification ability, and special skills</td>
                </tr>
                <tr>
                    <td>Wisdom</td>
                    <td>WIS</td>
                    <td>Affects perception ability, evasion, and practical judgment</td>
                </tr>
            </table>

            <h3>Derived Values</h3>
            <p>
                The following derived values are calculated from base stats:
            </p>

            <table>
                <tr>
                    <th>Derived Value</th>
                    <th>Primary Stat Influence</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td>Max HP</td>
                    <td>CON, STR</td>
                    <td>Maximum damage a character can receive</td>
                </tr>
                <tr>
                    <td>Attack Power</td>
                    <td>STR, DEX</td>
                    <td>Attack ability represented by base value and dice composition</td>
                </tr>
                <tr>
                    <td>Defense</td>
                    <td>CON, INT</td>
                    <td>Defense ability represented by base value and dice composition</td>
                </tr>
                <tr>
                    <td>Accuracy</td>
                    <td>DEX, WIS</td>
                    <td>Probability of hitting attacks (%)</td>
                </tr>
                <tr>
                    <td>Evasion</td>
                    <td>DEX, WIS</td>
                    <td>Probability of evading attacks (%)</td>
                </tr>
                <tr>
                    <td>Perception</td>
                    <td>WIS, DEX</td>
                    <td>Ability to discover hidden elements</td>
                </tr>
                <tr>
                    <td>Speed</td>
                    <td>DEX, STR, CON</td>
                    <td>Action speed (Very Slow to Very Fast)</td>
                </tr>
                <tr>
                    <td>Size</td>
                    <td>CON, STR</td>
                    <td>Character size (Tiny to Huge)</td>
                </tr>
            </table>
            
            <h3>Speed Values</h3>
            <p>
                Speed is represented by values 1-5 with corresponding names.
            </p>
            <table>
                <tr>
                    <th>Value</th>
                    <th>Name</th>
                </tr>
                <tr>
                    <td>1</td>
                    <td>Very Slow</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>Slow</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>Normal</td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>Fast</td>
                </tr>
                <tr>
                    <td>5</td>
                    <td>Very Fast</td>
                </tr>
            </table>

            <h3>Size Values</h3>
            <p>
                Size is represented by values 1-5 with corresponding names.
            </p>
            <table>
                <tr>
                    <th>Value</th>
                    <th>Name</th>
                </tr>
                <tr>
                    <td>1</td>
                    <td>Tiny</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>Small</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>Medium</td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>Large</td>
                </tr>
                <tr>
                    <td>5</td>
                    <td>Huge</td>
                </tr>
            </table>
        </section>

        <section id="skills">
            <h2>Skill System</h2>
            <p>
                Skills are abilities primarily used in combat.
                Many can be used as free actions and affect the next attack.
            </p>

            <h3>Combat Skills</h3>
            
            <h4>Power Strike</h4>
            <p>
                Channel strength for a powerful strike. Sacrifices accuracy for increased damage.
            </p>
            <ul>
                <li>Cost: 25</li>
                <li>Cooldown: 8</li>
                <li>Effect: Damage +50% (base), Accuracy -30% (base)</li>
                <li>Scaling: Effects vary based on STR/DEX ratio</li>
                <ul>
                    <li>Damage Bonus: Range of 40% to 80%</li>
                    <li>Accuracy Penalty: Range of -20% to -40%</li>
                </ul>
            </ul>
            <div class="formula">
damageBonus = min(0.8, max(0.4, 0.5 * (STR/DEX)))
accuracyPenalty = -min(0.4, max(0.2, 0.3 * (STR/DEX)))
            </div>

            <h4>Quick Slash</h4>
            <p>
                A swift attack that temporarily increases accuracy and speed.
            </p>
            <ul>
                <li>Cost: 20</li>
                <li>Cooldown: 12</li>
                <li>Effect: Accuracy +20%, Speed tier increased by 1</li>
            </ul>
        </section>

        <section id="vigor">
            <h2>Vigor System</h2>
            <p>
                Vigor is an important indicator of a character's fatigue and mental stamina.
                Low vigor has various negative effects on combat and exploration.
            </p>

            <h3>Vigor States</h3>
            <p>
                Vigor is represented on a scale of 0-100 and classified into the following states.
                The thresholds vary based on the character's Strength (STR) and Intelligence (INT).
            </p>
            <table>
                <tr>
                    <th>State</th>
                    <th>Threshold (Base)</th>
                    <th>Effects</th>
                    <th>Display</th>
                </tr>
                <tr>
                    <td>High</td>
                    <td>75% or higher</td>
                    <td>Normal state</td>
                    <td>∈ϴ‿ϴל (Green)</td>
                </tr>
                <tr>
                    <td>Moderate</td>
                    <td>50% to 74%</td>
                    <td>Mild fatigue, minor penalties to some checks</td>
                    <td>∈Ō_Ōל (Yellow)</td>
                </tr>
                <tr>
                    <td>Low</td>
                    <td>25% to 49%</td>
                    <td>Moderate fatigue, skill usage restrictions, significant penalties to checks</td>
                    <td>•˛⁔•ל (Red)</td>
                </tr>
                <tr>
                    <td>Critical</td>
                    <td>10% to 24%</td>
                    <td>Severe fatigue, most skills unusable, major penalties to all checks</td>
                    <td>◦˛⁔◦ל (Purple)</td>
                </tr>
                <tr>
                    <td>Exhausted</td>
                    <td>0% to 9%</td>
                    <td>Extreme fatigue, no skill usage, strong penalties to actions</td>
                    <td>(x_xל) (Gray)</td>
                </tr>
            </table>

            <h3>Vigor State Effects</h3>
            <p>
                Each vigor state affects the character's abilities, with detailed effects to be implemented in future updates.
                In the current implementation, low vigor reduces some of the character's abilities.
            </p>
            
            <p>
                More detailed effects and values will be added in future updates.
            </p>

            <h3>Cumulative Effects of Vigor</h3>
            <p>
                The combination of vigor state and HP state determines the character's overall condition.
                When both are deteriorated, survival becomes more difficult.
            </p>

            <h3>Vigor Decrease</h3>
            <p>
                Vigor decreases in the following situations:
            </p>
            <ul>
                <li>Skill usage (consumed according to skill cost)</li>
                <li>Time passage (chance to decrease based on turns per floor)</li>
                <li>Natural decrease based on HP state</li>
            </ul>

            <div class="formula">
// Decrease chance calculation
Decrease Chance = Base Chance + Floor Turns / 50
Base Chance by Danger Level:
  SAFE: 2%
  NORMAL: 3%
  DANGEROUS: 4%
  DEADLY: 5%
            </div>

            <h3>Vigor Recovery</h3>
            <p>
                Vigor can be recovered through the following methods:
            </p>
            <ul>
                <li>Resting (waiting in a safe place)</li>
                <li>Consuming food</li>
                <li>Using specific potions</li>
                <li>Moving to a safe area (natural recovery in SAFE danger level areas)</li>
            </ul>

            <h3>Vigor Effects System</h3>
            <p>
                When vigor decreases, special "vigor effects" may trigger in certain situations.
                These effects represent the player's fatigue state, with different effects being selected based on vigor state.
            </p>

            <h4>Effect Selection Mechanism</h4>
            <p>
                Each vigor state has a corresponding pool of effects, selected by weighted random selection.
                Higher weights increase the probability of that effect being chosen.
            </p>
            <table>
                <tr>
                    <th>Vigor State</th>
                    <th>Effect Types</th>
                    <th>Effect Weights</th>
                </tr>
                <tr>
                    <td>Moderate</td>
                    <td>
                        <ul>
                            <li>forgetSomeTiles (forget some explored tiles)</li>
                            <li>pauseAndShift (pause and world shift)</li>
                        </ul>
                    </td>
                    <td>
                        <ul>
                            <li>50</li>
                            <li>50</li>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <td>Low</td>
                    <td>
                        <ul>
                            <li>forgetSomeTiles (forget some explored tiles)</li>
                            <li>randomTeleport (random teleport)</li>
                            <li>pauseAndShift (pause and world shift)</li>
                            <li>forgetAllTiles (forget all explored tiles)</li>
                        </ul>
                    </td>
                    <td>
                        <ul>
                            <li>30</li>
                            <li>20</li>
                            <li>30</li>
                            <li>20</li>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <td>Critical</td>
                    <td>
                        <ul>
                            <li>forgetAllTiles (forget all explored tiles)</li>
                            <li>randomTeleport (random teleport)</li>
                            <li>forceDescend (forced floor descent)</li>
                            <li>pauseAndShift (pause and world shift)</li>
                        </ul>
                    </td>
                    <td>
                        <ul>
                            <li>25</li>
                            <li>25</li>
                            <li>20</li>
                            <li>30</li>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <td>Exhausted</td>
                    <td>
                        <ul>
                            <li>forceDescend (forced floor descent)</li>
                            <li>forgetAllTiles (forget all explored tiles)</li>
                            <li>randomTeleport (random teleport)</li>
                            <li>pauseAndShift (pause and world shift)</li>
                            <li>forgetSomeTiles (forget some explored tiles)</li>
                        </ul>
                    </td>
                    <td>
                        <ul>
                            <li>20</li>
                            <li>20</li>
                            <li>20</li>
                            <li>20</li>
                            <li>20</li>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <td>Positive</td>
                    <td>
                        <ul>
                            <li>revealAll (reveal entire map)</li>
                            <li>fullRestore (full restoration)</li>
                            <li>levelUp (level up)</li>
                        </ul>
                    </td>
                    <td>
                        <ul>
                            <li>5</li>
                            <li>3</li>
                            <li>2</li>
                        </ul>
                    </td>
                </tr>
            </table>
            
            <div class="note">
                Note: Positive effects will not trigger for players in the Exhausted state.
            </div>

            <h4>Vigor Effect Details</h4>
            <p>
                The specific contents of each vigor effect are as follows:
            </p>
            <table>
                <tr>
                    <th>Effect Name</th>
                    <th>Effect Description</th>
                    <th>In-game Message</th>
                </tr>
                <tr>
                    <td>pauseAndShift<br>(pause and world shift)</td>
                    <td>
                        <ul>
                            <li>Player temporarily enters a meditative state</li>
                            <li>Actions stop for 1 turn</li>
                            <li>Hallucination effect occurs</li>
                        </ul>
                    </td>
                    <td>"Your exhaustion forces you to pause, and the world shifts..."</td>
                </tr>
                <tr>
                    <td>forceDescend<br>(forced floor descent)</td>
                    <td>
                        <ul>
                            <li>Forced descent to the next floor</li>
                            <li>Portal transition effect occurs</li>
                            <li>Player moves down regardless of will</li>
                        </ul>
                    </td>
                    <td>"Your exhaustion forces you downward!"</td>
                </tr>
                <tr>
                    <td>randomTeleport<br>(random teleport)</td>
                    <td>
                        <ul>
                            <li>Teleport to a random location on the current floor</li>
                            <li>Won't teleport to walls or obstacle locations</li>
                            <li>Short portal transition effect occurs</li>
                        </ul>
                    </td>
                    <td>"Your mind wanders, and so does your body..."</td>
                </tr>
                <tr>
                    <td>forgetAllTiles<br>(forget all explored tiles)</td>
                    <td>
                        <ul>
                            <li>Reset exploration state of all tiles not currently in view</li>
                            <li>Complete loss of dungeon map memory</li>
                            <li>Only currently visible tiles remain in memory</li>
                        </ul>
                    </td>
                    <td>"Your memory fades completely..."</td>
                </tr>
                <tr>
                    <td>forgetSomeTiles<br>(forget some explored tiles)</td>
                    <td>
                        <ul>
                            <li>Approximately 30% of explored tiles are randomly forgotten</li>
                            <li>Tiles in view are not affected</li>
                            <li>Parts of the map become ambiguous</li>
                        </ul>
                    </td>
                    <td>"Your memory becomes hazy..."</td>
                </tr>
                <tr>
                    <td>revealAll<br>(reveal entire map)</td>
                    <td>
                        <ul>
                            <li>All tiles on the floor are temporarily revealed</li>
                            <li>All walls, passages, and rooms become visible</li>
                            <li>Temporary revelation-like effect</li>
                        </ul>
                    </td>
                    <td>"A moment of clarity reveals all!"</td>
                </tr>
                <tr>
                    <td>fullRestore<br>(full restoration)</td>
                    <td>
                        <ul>
                            <li>HP restored to maximum</li>
                            <li>Vigor restored to maximum</li>
                            <li>Meditation sound plays</li>
                        </ul>
                    </td>
                    <td>"A surge of energy restores you!"</td>
                </tr>
                <tr>
                    <td>levelUp<br>(level up)</td>
                    <td>
                        <ul>
                            <li>Player immediately levels up</li>
                            <li>Same effect as normal level up process</li>
                            <li>Possibility of stat increase and skill point acquisition</li>
                        </ul>
                    </td>
                    <td>"A mysterious force empowers you!"</td>
                </tr>
            </table>

            <h4>Hallucination Effect</h4>
            <p>
                All vigor effects cause temporary "hallucination effects."
                These effects appear as visual distortions and color changes on the game screen,
                visually representing the player's fatigue state.
                The duration of hallucination effects varies by effect type.
            </p>

            <h4>Effect Trigger Timing</h4>
            <p>
                Vigor effects may trigger under certain conditions during game progression.
                As vigor state worsens, the probability of undesirable effects increases.
            </p>
            
            <div class="note">
                Strategic Tip: When vigor is in the "Low" or "Critical" state, it is recommended to rest in a safe place
                or use vigor recovery items to avoid undesirable vigor effects.
            </div>
        </section>

        <section id="health">
            <h2>Health Status System</h2>
            <p>
                A character's health status changes based on remaining HP.
                Each health status is color-coded in the game to visually communicate the current state to the player.
            </p>

            <h3>Health Status Types</h3>
            <table>
                <tr>
                    <th>Status</th>
                    <th>Threshold (Base)</th>
                    <th>Color</th>
                </tr>
                <tr>
                    <td>Healthy</td>
                    <td>75% or higher</td>
                    <td>Green</td>
                </tr>
                <tr>
                    <td>Wounded</td>
                    <td>50% to 74%</td>
                    <td>Yellow</td>
                </tr>
                <tr>
                    <td>Badly Wounded</td>
                    <td>25% to 49%</td>
                    <td>Red</td>
                </tr>
                <tr>
                    <td>Near Death</td>
                    <td>10% to 24%</td>
                    <td>Purple</td>
                </tr>
                <tr>
                    <td>Dead</td>
                    <td>0 HP</td>
                    <td>Gray</td>
                </tr>
            </table>

            <p>
                These thresholds vary based on the character's Constitution (CON) and Wisdom (WIS).
                As HP status worsens, the natural decrease in vigor may accelerate.
            </p>

            <h3>Natural Healing System</h3>
            <p>
                Characters have a chance to naturally heal HP each turn.
                The healing amount is calculated based on Constitution (CON).
            </p>

            <div class="formula">
// Natural healing success chance
Success Chance = 10 + floor(CON / 6)  // Base 10% chance, +1% per 6 CON
            </div>
        </section>

        <section id="danger">
            <h2>Danger Level System</h2>
            <p>
                Each area of the dungeon has a "danger level" which affects 
                monster strength and spawn rate, quality of dropped items, and more.
            </p>

            <h3>Danger Level Types</h3>
            <table>
                <tr>
                    <th>Danger Level</th>
                    <th>Name</th>
                    <th>Level Modifier</th>
                    <th>Characteristics</th>
                </tr>
                <tr>
                    <td>SAFE</td>
                    <td>Serene</td>
                    <td>-1</td>
                    <td>"A gentle breeze carries the scent of ancient stone. The air feels unusually peaceful, almost protective."<br>
                        Few and weak monsters. Vigor may naturally recover in some cases.</td>
                </tr>
                <tr>
                    <td>NORMAL</td>
                    <td>Neutral</td>
                    <td>0</td>
                    <td>"The familiar musty scent of the dungeon fills the air. Distant echoes remind you to remain vigilant."<br>
                        Balanced placement of monsters and items.</td>
                </tr>
                <tr>
                    <td>DANGEROUS</td>
                    <td>Perilous</td>
                    <td>+1</td>
                    <td>"The shadows seem to writhe with malicious intent. Every sound carries an undertone of danger."<br>
                        Powerful monsters appear more frequently, with higher chance of finding quality items.</td>
                </tr>
                <tr>
                    <td>DEADLY</td>
                    <td>Fatal</td>
                    <td>+2</td>
                    <td>"An oppressive darkness weighs heavily on your soul. The very air seems to pulse with deadly energy."<br>
                        Very powerful monsters appear. Higher chance of finding valuable items, but survival is difficult.</td>
                </tr>
            </table>

            <h3>Danger Level Effects</h3>
            <p>
                Danger level affects the following elements:
            </p>
            <ul>
                <li>Monster spawn rate and strength</li>
                <li>Quality and quantity of dropped items</li>
                <li>Trap spawn rate and danger</li>
                <li>Vigor decrease and recovery chances</li>
                <li>Natural healing probability</li>
            </ul>

            <div class="note">
                Higher danger level areas offer the possibility of better rewards,
                but the associated risks are also greater. Explore carefully according to the situation.
            </div>
        </section>

        <section id="formulas">
            <h2>Formulas</h2>
            <p>
                Below are the calculation formulas for various in-game parameters.
            </p>

            <h3>Max HP</h3>
            <div class="formula">
MAX_HP = floor((CON * 2 + floor(STR / 4)) * sizeModifier * (1 + (level * 0.25)))
sizeModifier = 0.8 + (size.value * 0.1)  // Tiny: 0.9x, Small: 1.0x, Medium: 1.1x, Large: 1.2x, Huge: 1.3x
            </div>

            <h3>Attack Power</h3>
            <div class="formula">
ATTACK.base = max(1, floor((STR * 0.7 - DEX / 4) * sizeModifier))
ATTACK.diceCount = max(1, floor(sqrt(DEX) / 2))
ATTACK.diceSides = max(2, floor(sqrt(STR) * 2))
sizeModifier = 0.8 + (size.value * 0.1)
            </div>

            <h3>Defense</h3>
            <div class="formula">
DEFENSE.base = max(1, floor((CON * 0.5 - INT / 5) * sizeModifier))
DEFENSE.diceCount = max(1, floor(sqrt(CON) / 3))
DEFENSE.diceSides = max(2, floor(sqrt(CON) * 1.5))
sizeModifier = 0.8 + (size.value * 0.1)
            </div>

            <h3>Accuracy</h3>
            <div class="formula">
ACCURACY = min(85, max(20, 50 + floor(DEX * 0.8) + floor(WIS * 0.4) - floor(CON / 4) + speedMod + sizeMod))
speedMod = (speed.value - 3) * 5  // Based on Normal(3) ±5%
sizeMod = (3 - size.value) * 3    // Based on Medium(3) ±3%
            </div>

            <h3>Evasion</h3>
            <div class="formula">
EVASION = min(60, max(5, 8 + floor(DEX * 0.6) + floor(WIS * 0.3) - floor(CON / 5) - floor(STR / 5) + speedMod + sizeMod))
speedMod = (speed.value - 3) * 4  // Based on Normal(3) ±4%
sizeMod = (3 - size.value) * 3    // Based on Medium(3) ±3%
            </div>

            <h3>Perception</h3>
            <div class="formula">
PERCEPTION = max(3, floor((WIS + DEX) / 2) + speedMod + sizeMod)
speedMod = (speed.value - 3)
sizeMod = (3 - size.value)
            </div>

            <h3>Speed</h3>
            <div class="formula">
// When all stats are equal
if (all stats equal) {
    value = DEX
    if (value <= 6) return { value: 1, name: "Very Slow" }
    if (value <= 9) return { value: 2, name: "Slow" }
    if (value <= 13) return { value: 3, name: "Normal" }
    if (value <= 16) return { value: 4, name: "Fast" }
    return { value: 5, name: "Very Fast" }
}

// Normal calculation
baseSpeed = DEX - ((STR + CON) / 2)
if (baseSpeed <= -4) return { value: 1, name: "Very Slow" }
if (baseSpeed <= -2) return { value: 2, name: "Slow" }
if (baseSpeed <= 2) return { value: 3, name: "Normal" }
if (baseSpeed <= 4) return { value: 4, name: "Fast" }
return { value: 5, name: "Very Fast" }
            </div>

            <h3>Size</h3>
            <div class="formula">
// When all stats are equal
if (all stats equal) {
    value = CON
    if (value <= 6) return { value: 1, name: "Tiny" }
    if (value <= 9) return { value: 2, name: "Small" }
    if (value <= 13) return { value: 3, name: "Medium" }
    if (value <= 16) return { value: 4, name: "Large" }
    return { value: 5, name: "Huge" }
}

// Normal calculation
baseSize = (CON * 0.7 + STR * 0.3)
if (baseSize <= 7) return { value: 1, name: "Tiny" }
if (baseSize <= 10) return { value: 2, name: "Small" }
if (baseSize <= 14) return { value: 3, name: "Medium" }
if (baseSize <= 18) return { value: 4, name: "Large" }
return { value: 5, name: "Huge" }
            </div>

            <h3>Critical Range</h3>
            <div class="formula">
CRITICAL_RANGE = min(5, max(1, 3 + floor((DEX - 10) * 0.15) + floor((INT - 10) * 0.1)))
            </div>
        </section>

        <div class="note" style="margin-top: 40px; text-align: center; padding: 15px;">
            <strong>How to Open/Close Wiki in-game:</strong><br>
            Press <kbd>W</kbd> key to open the Wiki.<br>
            Press <kbd>ESC</kbd> key or click the "Close" button in the top-right to close the Wiki.
        </div>

        <footer>
            <p>ComplexRL System Wiki - Creation Date: <%= new Date().toLocaleDateString('en-US') %></p>
        </footer>
    </div>
</body>
</html> 